# SQLite 数据库说明

## 存储位置
`stock_data.db`（与 `test_pyqt5.py` 同目录）

---

## 需要存入数据库（方便日常使用）

| 数据 | 说明 | 表 |
|------|------|-----|
| **公司代码** | 股票代码（如 sz000001） | stocks.code |
| **日K 原始数据** | 日期、开、高、低、收、成交额、成交量 | daily_k |
| **来源路径** | 导入时的 .day 文件路径（可选） | stocks.source_path |

以上是**数据源**，存入后下次打开可直接从 DB 加载，无需再读 .day 文件。

---

## 不需要存入数据库（运行时计算）

| 数据 | 说明 |
|------|------|
| **周K、月K** | 由日K 聚合得到，需要时实时计算 |
| **股价均线** Ma5～Ma240 | 由收盘价计算，需要时实时计算 |
| **成交量均线** Ma5～Ma90 | 由成交量计算，需要时实时计算 |

均为派生指标，由日K 实时计算即可，存库会冗余且增加维护成本。

---

## 表结构

### stocks
- `code` TEXT PRIMARY KEY：股票代码
- `name` TEXT：股票名称（预留）
- `source_path` TEXT：.day 文件路径（可选）
- `updated_at` TEXT：最后更新时间

### daily_k
- `code` TEXT：股票代码
- `date` TEXT：日期 (YYYY-MM-DD)
- `open`, `high`, `low`, `close`：开高低收
- `amount`：成交额
- `vol`：成交量（股数）

主键：`(code, date)`

---

## 数据流
1. **导入**：选择 .day 文件 → 解析 → 写入 DB → 加入列表
2. **切换股票**：点击列表项 → 优先从 DB 读取 → 若无则从 path 对应的 .day 读取并写入 DB
3. **启动**：从 DB 读取已导入股票列表 → 选中第一只 → 从 DB 加载日K
